<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WoW Logs Analysis - Classic WoW Manager</title>
    <link rel="stylesheet" href="/style.css">
    <link rel="stylesheet" href="/logs.css">
</head>
<body>
    <div class="top-bar">
        <div class="top-bar-left">
            <img src="/images/1p_logo.png" alt="1Principles" class="app-logo" width="110" height="30">
            <nav class="top-nav">
                <a href="/" class="top-nav-link">Home</a>
                <div class="top-nav-dropdown">
                    <button class="top-nav-link dropdown-toggle" id="upcoming-raids-dropdown">
                        Upcoming Raids <i class="fas fa-chevron-down"></i>
                    </button>
                    <div class="dropdown-menu" id="upcoming-raids-menu">
                        <div class="dropdown-loading">Loading raids...</div>
                    </div>
                </div>
            </nav>
        </div>
        <div id="auth-container">
            <!-- Auth content is now loaded by top-bar.js -->
        </div>
    </div>

    <!-- Active Raid Bar (shown when raid is selected) -->
    <div class="raid-bar" id="raid-bar" style="display: none;">
        <div class="raid-bar-left">
            <div class="raid-title" id="raid-title">Loading raid...</div>
        </div>
        <div class="raid-bar-right">
            <nav class="raid-nav">
                <a href="#" class="raid-nav-link" id="raid-roster-link">Roster</a>
                <a href="#" class="raid-nav-link" id="raid-assignments-link">Assignments</a>
                <a href="#" class="raid-nav-link" id="raid-goldpot-link">Gold Pot</a>
            </nav>
        </div>
    </div>

    <div class="container">
        <div class="page-header">
        </div>

        <div class="logs-input-section">
            <div class="input-container">
                <input type="text" id="logInput" placeholder="Enter wowlogs link">
                <button id="analyzeBtn" class="run-btn">Step 1 - Confirm logs</button>
                <button id="runRpbBtn" class="run-btn rpb-btn">Step 2 - Run RPB</button>
            </div>
        </div>

        <!-- Unified Workflow Section -->
        <div class="unified-workflow-section">
            <div class="workflow-separator">
                <span>OR</span>
            </div>
            <div class="workflow-container">
                <h3>üöÄ Complete Workflow</h3>
                <p>Run all steps automatically: RPB Analysis ‚Üí Archive ‚Üí Import Data</p>
                <div class="workflow-input-container">
                    <input type="text" id="workflowLogInput" placeholder="Enter wowlogs link for complete workflow">
                    <button id="runCompleteWorkflowBtn" class="workflow-btn">Run Complete Workflow</button>
                </div>
            </div>
        </div>

        <!-- Workflow Progress Indicator -->
        <div id="workflowProgress" class="workflow-progress" style="display: none;">
            <div class="progress-header">
                <h3>Workflow Progress</h3>
            </div>
            <div class="progress-steps">
                <div class="progress-step" id="step1Progress">
                    <div class="step-number">1</div>
                    <div class="step-content">
                        <div class="step-title">RPB Analysis</div>
                        <div class="step-status" id="step1Status">Waiting...</div>
                    </div>
                    <div class="step-indicator" id="step1Indicator">‚è≥</div>
                </div>
                <div class="progress-step" id="step2Progress">
                    <div class="step-number">2</div>
                    <div class="step-content">
                        <div class="step-title">Archive Results</div>
                        <div class="step-status" id="step2Status">Waiting...</div>
                    </div>
                    <div class="step-indicator" id="step2Indicator">‚è≥</div>
                </div>
                <div class="progress-step" id="step3Progress">
                    <div class="step-number">3</div>
                    <div class="step-content">
                        <div class="step-title">Import Data</div>
                        <div class="step-status" id="step3Status">Waiting...</div>
                    </div>
                    <div class="step-indicator" id="step3Indicator">‚è≥</div>
                </div>
            </div>
            <div class="progress-actions" id="workflowActions" style="display: none;">
                <button id="retryWorkflowBtn" class="btn btn-secondary">Retry Failed Step</button>
                <button id="resetWorkflowBtn" class="btn btn-secondary">Start Over</button>
            </div>
        </div>

        <div id="loadingIndicator" class="loading-indicator" style="display: none;">
            <div class="spinner"></div>
            <p>Fetching log data...</p>
        </div>

        <div id="errorDisplay" class="error-display" style="display: none;">
            <div class="error-content">
                <h3>Error</h3>
                <p id="errorMessage"></p>
            </div>
        </div>

        <div id="logData" class="log-data-container" style="display: none;">
            <!-- Fight Data Section -->
            <div class="data-section">
                <h2>üìä Fight Data</h2>
                <div id="fightDataContent" class="data-content">
                    <!-- Fight data will be populated here -->
                </div>
            </div>

            <!-- Characters Section -->
            <div class="data-section">
                <h2>üë• Characters</h2>
                <div id="charactersDataContent" class="data-content">
                    <!-- Characters data will be populated here -->
                </div>
            </div>

            <!-- Damage Data Section -->
            <div class="data-section">
                <h2>‚öîÔ∏è Damage Done by Source</h2>
                <div id="damageDataContent" class="data-content">
                    <!-- Damage data will be populated here -->
                </div>
            </div>

            <!-- Healing Data Section -->
            <div class="data-section">
                <h2>üíö Healing Done by Source</h2>
                <div id="healingDataContent" class="data-content">
                    <!-- Healing data will be populated here -->
                </div>
            </div>

            <!-- Summary Data Section -->
            <div class="data-section">
                <h2>üìä Raid Summary</h2>
                <div id="summaryDataContent" class="data-content">
                    <!-- Summary data will be populated here -->
                </div>
            </div>

            <!-- Raw Data Section (collapsible) -->
            <div class="data-section">
                <h2>üîß Raw API Data <button id="toggleRawData" class="btn btn-secondary btn-small">Show</button></h2>
                <div id="rawDataContent" class="data-content raw-data" style="display: none;">
                    <div class="raw-data-tabs">
                        <button class="tab-btn active" data-tab="fights">Fights Data</button>
                        <button class="tab-btn" data-tab="summary">Summary Data</button>
                        <button class="tab-btn" data-tab="damage">Damage Data</button>
                        <button class="tab-btn" data-tab="healing">Healing Data</button>
                    </div>
                    <div class="tab-content">
                        <div id="rawFightsData" class="tab-pane active">
                            <pre id="rawFightsJson"></pre>
                        </div>
                        <div id="rawSummaryData" class="tab-pane">
                            <pre id="rawSummaryJson"></pre>
                        </div>
                        <div id="rawDamageData" class="tab-pane">
                            <pre id="rawDamageJson"></pre>
                        </div>
                        <div id="rawHealingData" class="tab-pane">
                            <pre id="rawHealingJson"></pre>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="/top-bar.js"></script>
    <script src="/logs.js"></script>
</body>
</html> 